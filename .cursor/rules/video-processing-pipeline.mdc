---
description: Documents video processing pipeline architecture and algorithms for automatic synchronization and compositing
globs: src/video/**/*,src/processing/**/*,src/pipeline/**/*,src/sync/**/*
alwaysApply: false
---


# video-processing-pipeline

The video processing pipeline implements sophisticated multi-stage synchronization and compositing with several unique domain components:

## Frame Processing Pipeline
Importance Score: 95
- Sequential frame sampling with intelligent keyframe selection
- Multi-algorithm perceptual fingerprinting using pHash, AverageHash, ColorMomentHash
- Frame matching using weighted hash similarity scoring
- Temporal synchronization via Dynamic Time Warping with monotonic constraints

## Background Adaptation Engine
Importance Score: 90
- Adaptive background frame selection based on foreground matching
- Dynamic timeline stretching/compression to maintain sync
- Intelligent frame interpolation between key matches
- Drift prevention through global optimal alignment

## Temporal Alignment System  
Importance Score: 85
- Frame-by-frame mapping with Sakoe-Chiba band constraint
- Automatic handling of mismatched frame rates
- Preservation of foreground frame timing and sequencing
- Linear interpolation for smooth continuous mapping

## Spatial Composition Logic
Importance Score: 80
- Template matching with normalized cross-correlation
- Dynamic foreground positioning and scaling
- Edge-based alignment for border matching mode
- Multi-pass position refinement

## Audio Integration
Importance Score: 75
- Automatic source selection (foreground preferred)
- Timeline synchronization with video frames
- Dynamic audio resampling and stretching
- Fallback handling for missing audio

Key Business Rules:
- Preserve foreground video quality and timing
- Prevent temporal drift between sources 
- Handle mismatched frame rates and resolutions
- Maintain frame-accurate synchronization

$END$