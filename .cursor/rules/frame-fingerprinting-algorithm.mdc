---
description: Specification for multi-algorithm perceptual hashing system used for video frame comparison and matching
globs: src/vidkompy/fingerprint/*.py,src/vidkompy/hash/*.py,src/vidkompy/compare/*.py
alwaysApply: false
---


# frame-fingerprinting-algorithm

Perceptual frame hashing system combining multiple algorithms for robust video frame comparison and matching.

## Core Algorithms

### Multi-Hash Generation System
Four distinct hash algorithms provide complementary frame analysis:
- pHash: Frequency domain analysis using DCT transform for lighting-invariant fingerprinting
- AverageHash: Color distribution mapping for overall frame characteristics
- ColorMomentHash: Statistical color pattern analysis 
- MarrHildrethHash: Edge and shape detection focused fingerprinting

### Combined Fingerprint Pipeline
1. Frame standardization to 64x64 grayscale
2. Parallel hash computation across all algorithms
3. Color histogram generation
4. Combined fingerprint dictionary creation with all hash results

### Similarity Scoring
- Weighted Hamming distance between hash values
- Histogram correlation calculation
- Normalized composite similarity score based on weighted averages

## Domain Rules

1. Hash Weighting Priorities
- pHash given highest weight due to robustness against video compression
- MarrHildrethHash weighted for structural features
- ColorMomentHash/AverageHash balanced for color fidelity

2. Frame Standardization Requirements
- Maintain aspect ratio during resizing
- Convert to grayscale before hash computation
- Normalize brightness levels

3. Comparison Thresholds
- Minimum similarity threshold: 0.85 for frame match
- Maximum Hamming distance: 0.25 for hash comparison
- Histogram correlation minimum: 0.70

4. Frame Selection Logic
- Sample frames at consistent intervals
- Skip likely transition frames
- Validate frame content before processing

## Business Impact Scores

- Multi-Hash Generation: 95
- Combined Fingerprint Creation: 90  
- Similarity Scoring System: 85
- Frame Selection Logic: 75

$END$